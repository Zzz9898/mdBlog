
>- ## Java之异常相关
>  
- #### Java异常体系结构
  - Java中的异常类均以Throwable为父类，而Throwable又派生出Error类和Exception类这两大子类
    - Error类及其子类：代表JVM自身的异常，这一类异常发生时，无法通过程序来修正，最可靠的方式就是尽快地停止JVM的运行
    - Exception类及其子类：代表程序运行中发生了意料之外的事情，这些意外的事情可以被Java异常处理机制处理(可划分为两大类)
      - RuntimeException及其子类：这一类异常其实是程序设计的错误，通过修正程序设计是可以避免的。例如，数组越界异常、数值异常等
      - 非RuntimeException及其子类：这一类异常的发生通常由外部因素导致，是不可预知和避免的。例如，IO异常、类型寻找异常等
      ![](http://wxf.zcoder.top/server/files/ect.png)
  - Throwable对象，其主要的成员变量有detailMessage和cause
    - detailMessage: 为一个String，用来存储异常的详细信息
    - cause: cause为另一个Throwable对象，用来存储异常引发原因  
      <font size=2>这是因为一个异常发生时，通常引发的的上级程序也发生异常，从而导致一连串的异常产生，叫作异常链。一个异常的cause属性可以指向引发它的下级异常，从而将整个异常链保存下来</font>
- #### Java异常机制
  - 异常处理机制为：抛出异常，捕捉异常
    - 抛出异常：当一个方法出现错误引发异常时，方法创建异常对象并交付运行时系统，异常对象中包含了异常类型和异常出现时的程序状态等异常信息。运行时系统负责寻找处置异常的代码并执行
      - <font size=2>抛出异常（throw）：如果代码可能会引发某种错误，可以创建一个合适的异常类实例并抛出它，这就是抛出异常</font>
    - 捕捉异常：在方法抛出异常之后，运行时系统将转为寻找合适的异常处理器（exception handler）。潜在的异常处理器是异常发生时依次存留在调用栈中的方法的集合，当异常处理器所能处理的异常类型与方法抛出的异常类型相符时，即为合适的异常处理器，运行时系统从发生异常的方法开始，依次回查调用栈中的方法，直至找到含有合适异常处理器的方法并执行，当运行时系统遍历调用栈而未找到合适的异常处理器，则运行时系统终止，同时，意味着Java程序的终止
      - <font size=2>捕获异常（try-catch）：当抛出一个异常时，可以在try-catch块中捕获它并进行处理，若执行try块的过程中没有发生异常，则跳过catch子句，若是出现异常，try块中剩余语句不再执行，开始逐步检查catch块，判断catch块的异常类实例是否是捕获的异常类型，匹配后执行相应的catch块中的代码，如果异常没有在当前的方法中被捕获，就会被传递给该方法的调用者，这个过程一直重复，直到异常被捕获或被传给main方法（交给JVM来捕获）。</font>
      - <font size=2>catch捕获异常的顺序：一个通用父类可以派生出各种异常类，如果一个catch块可以捕获一个父类的异常对象，它就能捕获那个父类的所有子类的异常对象，如果捕获的是多个同类型异常，则子类异常在前，父类异常在后，不然会导致编译错误，这是因为父类异常囊括了子类异常，如果父类异常在前，子类异常永远捕获不到，导致有时候无法准确描述错误信息</font>
      - <font size=2>抛出的是运行时异常，可以选择捕获或者不捕获。但如果抛出检查异常，在编译时就必须选择捕获或者声明</font>
    - finally语句块
      - <font size=2>无论是否有异常，finally块中的代码总是会被执行的</font>
      - <font size=2>try块中引起异常，异常代码之后的语句不再执行，若被catch块捕获，执行匹配的catch块，然后执行finally语句，若catch块不能捕获异常，则执行finally语句，之后将异常传递给这个方法的调用者</font>
      - <font size=2>finally遇见如下情况不会执行</font>
        - <font size=2>在前面的代码中用了System.exit()退出程序</font>
        - <font size=2>finally语句块中发生了异常</font>
        - <font size=2>程序所在的线程死亡</font>
        - <font size=2>关闭CPU</font>
      - <font size=2>若finally语句块中有返回信息，则执行完finally中的代码后不会返回到try或catch语句块中去了，直接退出了方法，返回的是finally中的信息</font>
- #### 高效主流异常处理
  - 设计一个通用的继承RuntimeException的自定义异常类来统一处理
  - 其余异常类都统一转译为上述自定义异常类
  - 在catch之后，抛出上类异常的子类，并提供足以定位的信息
  - 由前端接收自定义异常同一处理
- #### try-catch的性能
  - try-catc块影响JVM的优化
  - 异常对象实例需要保存栈快照信息，开销较大
- #### 常见异常举例
  - RuntimeException
    - NullPointerException - 空指针引用异常
    - ClassCastException - 类型强制转换异常
    - IllegalArgumentException - 传递非法参数异常
    - ArrayIndexOutOfBoundsException - 下标越界异常
    - NumberFormatException - 数字格式异常
  - 非RuntimeException
    - ClassNotFoundExcetpion - 找不到指定Class的异常
    - IOExcetpio - IO操作异常
  - Error
    - NoClassDefFoundError - 找不到Class定义的异常
    - StackOverflowError - 深递归导致栈被耗尽而抛出的异常
    - OutOfMemoryError - 内存溢出异常